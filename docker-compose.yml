# ============================================================================
# 42-BERLIN-ENGINE DOCKER COMPOSE
# Phase 10: Container Orchestration for AutoGPT Integration
# ============================================================================
#
# Usage:
#   docker compose up -d
#   docker compose logs -f 42-core
#   curl http://localhost:9090/health
#
# For AutoGPT integration, use host IP (not localhost):
#   OPENAI_API_BASE_URL=http://172.17.0.1:9090/v1
# ============================================================================

services:
  42-core:
    build:
      context: .
      dockerfile: Dockerfile
    image: 42-berlin/engine:v1
    container_name: 42-core
    restart: unless-stopped
    ports:
      - "9090:9090"
    volumes:
      # Mount your model weights
      - ./Ministral-Stuff:/app/weights:ro
      # Persistent fluid weights (for Nested Learning)
      - ./fluids:/app/fluids
    environment:
      - OMP_NUM_THREADS=8
      - PORT=9090
    healthcheck:
      test: ["CMD", "curl", "-sf", "http://localhost:9090/health"]
      interval: 10s
      timeout: 5s
      start_period: 120s  # Model loading takes time
      retries: 3
    deploy:
      resources:
        limits:
          memory: 16G
        reservations:
          memory: 8G
